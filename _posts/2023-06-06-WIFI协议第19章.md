---
layout: post
title:  "WIFI协议第19章"
author: "Geoffrey Hou"
comments: true
tags: WIFI
excerpt_separator: <!--more-->
sticky: true
hidden: true
---

<head>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
</head>

WIFI协议第19章。<!--more-->

## **19.3 HT PHY**

### **19.3.3 Transmitter block diagram**

HT-MF和HT-GF格式通过以下过程生成发送：

1. *Scrambler*：见19.3.11.3。
2. *Encoder parser*：如果要使用二进制卷积码BBC，在$N_{E S}$（Data字段的BCC编码器个数）个BCC编码器中，对加扰比特进行解复用，以round robin方式。
3. *FEC encoders*：FEC编码器可能包括一个二进制卷积编码器，后面跟着一个打孔设备，或者 它可能包括一个低密度奇偶校验 (LDPC) 编码器。
4. *Stream parser*：将编码器的输出分成块，这些块被发送到不同的交织器和映射设备。发送到交织器的比特序列称为空间流。
5. *Interleaver*：交织每个空间流的比特（改变比特的顺序）以防止相邻噪声位的长序列进入BCC解码器。**仅当使用BCC编码时才应用交织**。
6. *Constellation mapper*：把每个空间流的比特序列映射到星座点。
7. *STBC*：STBC编码器把星座点从$N_{S S}$个空间流扩展到$N_{S T S}$个空时流，采用空时码。只有在$N_{S S}<N_{S T S}$时才使用STBC，见19.3.11.9.2。
8. *Spatial mapper*：把空时流映射到发送链。该过程可能包含下面选项中的一个：
	1. *Direct mapping*：每个空时流的星座点直接映射到发送链（一一映射）。
	2. *Spatial expansion*：来自所有时空流的星座点向量通过矩阵乘法扩展，以产生所有传输链的输入。
	3. *Beamforming*：与空间扩展类似，来自所有时空流的星座点的每个矢量都乘以一个导向矢量矩阵，以产生传输链的输入。
9. *Inverse discrete Fourier transform (IDFT)*：把星座点块转换到时域块。
10. *Cyclic shift (CSD) insertion*：插入循环移位来避免不希望的波束成形。CSD插入可以在IDFT之前，也可以在IDFT之后。一共有三种循环移位类型：
	1. 每个发送链特定的循环移位，取值见表19-9。
	2. 每个特定空时流的循环移位，取值见表19-10。
	3. $M_{C S D}(k)$作为空间映射的一部分，见19.3.11.11.2。
11. *GI insertion*：在符号前面加上自己的循环扩展。
12. *Windowing*：加窗是可选的，用来平滑每个符号的边缘以增加频谱衰减。



Figure 19-2和Figure 19-3显示了发送示意图。

Figure 19-2是生成HT-MF PPDU的HT-SIG的框图。该框图也可以用于生成HT-MF PPDU的non-HT部分，只是在生成L-STF和L-LTFs时不需要BCC编码和交织。

![image-20230606145610818](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/bef20662-a250-4123-974e-c9e7e2aa17ce)



Figure 19-3是生成HT-MF PPDU和HT-GF PPDU的Data字段的框图。A subset of these transmitter blocks consisting of the constellation mapper and CSD blocks, as well as the blocks to the right of, and including, the spatial mapping block, are also used to generate the HT-STF, HT-GF-STF, and HT-LTFs. The HT-greenfield format SIGNAL field is generated using the transmitter blocks shown in Figure 19-2, augmented by additional CSD and spatial mapping blocks.

![image-20230606145625589](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/9e493b23-965b-4772-a33c-309d7ec769e1)



### **19.3.4 Overview of the PPDU encoding process**



### **19.3.5 Modulation and coding scheme (MCS)**

MCS是一个值，用来确定调制、编码、空间信道个数，由HT-SIG携带。码率相关的参数见Table 19-27到Table 19-41。这些表格的MCS索引从0到76。MCS 0到7和32只有一个空间流；MCS 8到31有多个空间流（在所有流上使用equal modulation，EQM）；MCS 33到76有多个空间流（在所有流上使用unequal modulation，UEQM）。MCS 77到127保留。

Table 19-27到Table 19-30对应20MHz的1、2、3、4流的EQM MCS。Table 19-31到Table 19-34对应40MHz的1、2、3、4流的EQM MCS。20MHz和40MHz使用相同的EQM MCS。Table 19-35对应40MHz、6Mbps的MCS 32格式。

剩下的表格，Table 19-36到Table 19-41对应$N_{S S}>1$的UEQM空间流。Table 19-36到Table 19-38是20MHz、Table 19-39到Table 19-41是40MHz。

HT STA要支持所有的一个空间流使用20MHz的（MCS 0到7）EQM。如果HT AP不是VHT AP，那么他应该支持20MHz的2个空间流的所有EQM。其他所有的MCS和模式都是可选项，包括20MHz的400 ns GI和MCS 16到76。

### **19.3.6 Timing-related parameters**



### **19.3.7 Mathematical description of signals**

当配置为20 MHz non-HT format 或者 20 MHz HT format时，信道被划分为64个子载波。

- 20 MHz non-HT format：信号在子载波-26到-1和1到26上，0是dc载波位置。（TXVECTOR的参数FORMAT等于NON_HT，MODULATION参数等于ERP-OFDM或OFDM）
- 20 MHz HT format：信号在子载波-28到-1和1到28上。（TXVECTOR的参数FORMAT等于HT_MF或HT_GF，CH_BANDWIDTH等于HT_CBW20）



当配置为40 MHz HT format时，使用40 MHz信道。信道被划分为128个子载波。信号在子载波-58到-2和2到58上。



当配置为40 MHz HT upper format 或 40 MHz HT lower format时，这种upper或lower 20 MHz的信道被划分为64个子载波。

- 40 MHz HT lower format：信号在子载波-60到-4上。
- 40 MHz HT upper format：信号在子载波4到60上。



当配置为MCS 32 和 non-HT duplicate formats时，相同的数据通过2个相邻的20 MHz信道传输。这时候，40 MHz信道被划分为128个子载波，信号在子载波-58到-6和6到58上。



实际发送的信号表示为：$r_{R F}(t)=\operatorname{Re}\left\{r(t) \exp \left(j 2 \pi f_c t\right)\right\}$，$f_c$是中心频率。

发送的RF信号通过基带信号调制得到，基带信号包括一些字段。不同字段的时间边界见下图。

![image-20230607152757857](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/0b024c77-c6d5-4072-a6c6-15b76543dfc3)



在HT-MF中，发送链$i_{T X}$上的信号为：

![image-20230607152923808](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/c991db2c-3756-4325-8bb4-0838cfc02cbd)



在HT-GF中，发送链$i_{T X}$上的信号为：

![image-20230607152953280](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/4194ff7d-f2c6-4633-a00f-300aef8b3300)

![image-20230607153004807](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/d69db7b4-f40c-484e-9538-c489997afc14)



每个基带波形$r_{\text {Field }}^{\left(i_{T X}\right)}(t)$，定义为每个OFDM符号的DFT：


$$
r_{\text {Field }}^{\left(i_{T X}\right)}(t)=\frac{1}{\sqrt{N_{\text {Field }}^{\text {Tone }} \cdot N_{T X}}} w_{\mathrm{T}_{\text {Field }}}(t) \sum_k \Upsilon_k X_k^{\left(i_{T X}\right)} \exp \left(j 2 \pi k \Delta_F t\right)
$$


这是所有字段的通用形式。一个建议的加窗函数$w_{\mathrm{T}_{\text {Field }}}(t)$的定义见17.3.2.5。

函数$\Upsilon_k$用来表示在40 MHz信道中upper子载波的旋转：


$$
\begin{aligned}
& \Upsilon_k=\left\{\begin{array}{l}
1, k \leq 0, \text { in a } 40 \mathrm{MHz} \text { channel } \\
j, k>0, \text { in a } 40 \mathrm{MHz} \text { channel }
\end{array}\right. \\
& \Upsilon_k=1, \text { in a } 20 \mathrm{MHz} \text { channel }
\end{aligned}
$$


不同字段的$N_{\text {Field }}^{\text {Tone }}$见下表。

![image-20230607153531364](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/cf7f13fa-289d-4f6e-bbca-a4cf4ae2c460)

![image-20230607153541867](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/b44f45c1-c4c8-4913-82e2-7b36cbd79f94)



### **19.3.8 Transmission in the upper/lower 20 MHz of a 40 MHz channel**

当在40MHz信道的上下20MHz部分发送时，19-1的数学表达式中把$f_c$替换为$f_c \pm 10$ MHz。

这个规则用于：

1. 40MHz信道中20MHz HT传输（TXVECTOR primitive CH_BANDWIDTH等于HT_CBW20，并且CH_OFFSET primitive等于CH_OFF_20U或CH_OFF_20L时）
2. 40MHz信道中20MHz non-HT传输（TXVECTOR primitive CH_BANDWIDTH等于NON_HT_CBW20，并且CH_OFFSET primitive等于CH_OFF_20U或CH_OFF_20L时）



### **19.3.9 HT preamble**

#### **19.3.9.1 Introduction**

HT preambles被定义为HT-MF和HT-GF来携带需要的信息。并且使用多个发送和接收天线。

在HT-MF中，为了和non-HT STAs兼容，定义了特定的non-HT字段。

在HT-GF中，所有的non-HT字段被忽略。特定的HT字段如下：

- 一个HT-GF-STF用于AGC控制，时间同步，粗频率估计
- 一个或多个HT-LTF，用于信道估计。第一个HT-LTF（HT-DLTF）需要用来解调PPDU的HT-Data部分，只对sounding PPDU，通过可选的HT-LTF（HT-ELTF）来探测MIMO信道中额外的空间维度
- HT-SIG，用于解析HT packet format

在多个发送链路的情况下，HT preambles使用循环移位来避免不希望的波束成形。

#### **19.3.9.2 HT-mixed format preamble**



#### **19.3.9.3 Non-HT portion of the HT-mixed format preamble**

##### **19.3.9.3.1 Introduction**

HT-MF中的L-STF、L-LTF、L-SIG见19.3.9.3.2到19.3.9.3.5。

##### **19.3.9.3.2 Cyclic shift definition**

这里定义的而循环移位用于HT-MF preamble中的non-HT字段 和 HT-MF preamble中的HT-SIG字段。

在一个信号$s(t)$上长度为$T_{C S}$的循环移位定义如下，这里的$T$定义为Table 19-6中的$T_{D F T}$。


$$
\left.s_{C S}\left(t ; T_{C S}\right)\right|_{T_{C S}<0}=\left\{\begin{array}{cc}
s\left(t-T_{C S}\right) & 0 \leq t<T+T_{C S} \\
s\left(t-T_{C S}-T\right) & T+T_{C S} \leq t \leq T
\end{array}\right.
$$


数据包中的每个OFDM符号的循环移位是分开的。Table 19-9给出了L-STF（HT-MF）、L-LTF、L-SIG使用的循环移位，HT-MF中的HT-SIG也是用这些循环移位。

对于超过4个发送链路的，额外的发送链路使用的循环移位应该在-200ns到0ns之间。

![image-20230607171749990](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/61de26bb-4050-4930-8cdf-b2d1f2699f23)

##### **19.3.9.3.3 L-STF definition**



##### **19.3.9.3.4 L-LTF definition**



##### **19.3.9.3.5 L-SIG definition**



#### **19.3.9.4 HT portion of HT-mixed format preamble**

##### **19.3.9.4.1 Introduction**

当发送HT-MF preamble时，HT preambles包括HT-STF、HT-LTFs、HT-SIG。

所有数字字段以无符号格式发送，LSB在前。

##### **19.3.9.4.2 Cyclic shift definition**

**这里定义的循环移位值用于HT-MF preamble的HT-STF、HT-LTFs字段。19.3.9.3.2中定义的循环移位值用于HT-MF preamble的HT-SIG字段。**

所有在HT-MF preamble的HT部分中，循环移位用来避免波束成形（在不同空时流中发送相似的信号时）。相同的循环移位用于这些流的frame的data部分。The values of the cyclic shifts to be used during the HT portion of the HT-mixed format preamble (with the exception of the HT_SIG) and the data portion of the frame are specified in Table 19-10. 

![image-20230609103420912](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/98141c98-4eb7-4319-bee8-9bfc7b707bf3)



##### **19.3.9.4.3 HT-SIG definition**

HT-SIG用来携带解释HT数据包格式的信息。HT-SIG的字段见下表。

![image-20230609103528099](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/d7b18f40-716c-4465-961d-04449e20869f)

![image-20230609103625344](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/9b92d19f-f731-487e-ac17-a184e0bf4c30)

HT-SIG1和HT-SIG2字段的结构见下图。

![image-20230609103853778](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/1f99030e-dea6-4614-a95d-bf37dd0dafbe)

HT-SIG包括两个部分，HT-SIG1和HT-SIG2字段，每个字段包括24比特。HT-SIG中的所有字段都是先发送LSB，并且HT-SIG1在HT-SIG2之前发送。

HT-SIG部分使用码率=1/2、交织、BPSK编码，并且要插入pilots（步骤见17.3.5.6、17.3.5.7、17.3.5.8、17.3.5.9）。为了满足检测HT-SIG起始的要求，BPSK星座点相对于L-SIG旋转了90°。

通过上述步骤产生96个复数的数据流，并且被划分为2个group，每个group包含48个复数：用$d_{k, n}, 0 \leq k \leq 47, n=0,1$表示。在20MHz带宽中HT-MF数据包的HT-SIG字段的时域波形为：


$$
\begin{aligned}
r_{H T-S I G}^{i_{T X}}(t)= & \frac{1}{\sqrt{N_{T X} \cdot N_{H T-S I G}^{T o n e}}} \sum_{n=0}^1 w_{\mathrm{T}_{S Y M}}\left(t-n T_{S Y M}\right) \\
& 26 \\
& \sum_{k=-26}\left(j D_{k, n}+p_{n+1} P_k\right) \exp \left(j 2 \pi k \Delta_F\left(t-n T_{S Y M}-T_{G I}-T_{C S}^{j_{T X}}\right)\right)
\end{aligned}
$$


40MHz带宽中的时域波形为：


$$
\begin{aligned}
r_{H T-S I G}^{i_{T X}}(t) & =\frac{1}{\sqrt{N_{T X} \cdot N_{H T-S I G}^{T o n e}}} \sum_{n=0}^1 w_{\mathrm{T}_{S Y M}}\left(t-n T_{S Y M}\right) \\
& \cdot \sum_{k=-26}\left(j D_{k, n}+p_{n+1} P_k\right)\left(\exp \left(j 2 \pi(k-32) \Delta_F\left(t-n T_{S Y M}-T_{G I}-T_{C S}^{i_{T X}}\right)\right)\right. \\
& \left.+j \exp \left(j 2 \pi(k+32) \Delta_F\left(t-n T_{S Y M}-T_{G I}-T_{C S}^{i_{T X}}\right)\right)\right)
\end{aligned}
$$


其中的参数见下图。

![image-20230609110422607](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/2ccf683a-a29d-4d76-b410-3187aa35db26)





注意：这里的定义得到的是QBPSK调制，也就是相对于HT-MF中的L-SIG和HT-GF中的第一个HT-LTF字段，data子载波旋转了90°。在HT-MF PPDU中，HT-SIG使用和preamble的non-HT部分相同的子载波个数和相同的循环移位。这样做是为了适应对HT-SIG中包含的信息进行稳健解调和解码所需的信道参数的估计。

![image-20230609111053392](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/62a337e7-13f1-45e3-af4c-5dfedbb27e6a)





##### **19.3.9.4.4 CRC calculation for HT-SIG**



##### **19.3.9.4.5 HT-STF definition**

HT-STF的目的是提升MIMO系统中的agc估计。HT-STF的持续时间是4us。

在20MHz带宽中，用于构建HT-STF的的频域序列和L-STF相同。在40MHz带宽中，在20MHz带宽的频域序列基础上进行复值和频域，upper子载波旋转90°。频域序列见下面公式。

对于20MHz：


$$
\begin{aligned}
H_{T S} S_{-28,28} & =\sqrt{1 / 2} \\
& \{0,0,0,0,1+j, 0,0,0,-1-j, 0,0,0,1+j, 0,0,0,-1-j, 0,0,0,-1-j, 0,0,0,1+j, 0,0,0, \\
& 0,0,0,0,-1-j, 0,0,0,-1-j, 0,0,0,1+j, 0,0,0,1+j, 0,0,0,1+j, 0,0,0,1+j, 0,0,0,0\}
\end{aligned}
$$


对于40MHz：


$$
\begin{aligned}
H T S_{-58,58} & =\sqrt{1 / 2} \\
& \{0,0,1+j, 0,0,0,-1-j, 0,0,0,1+j, 0,0,0,-1-j, 0,0,0,-1-j, 0,0,0,1+j, 0,0,0 \\
& 0,0,0,0,-1-j, 0,0,0,-1-j, 0,0,0,1+j, 0,0,0,1+j, 0,0,0,1+j, 0,0,0,1+j, 0,0,0,0,0 \\
& 0,0,0,0,0,0,0,0,0,0,1+j, 0,0,0,-1-j, 0,0,0,1+j, 0,0,0,-1-j, 0,0,0,-1-j, 0,0,0,1+j, \\
& 0,0,0,0,0,0,0,-1-j, 0,0,0,-1-j, 0,0,0,1+j, 0,0,0,1+j, 0,0,0,1+j, 0,0,0,1+j, 0,0\}
\end{aligned}
$$


发送链路$i_{T X}$上发送的时域信号表示为：

![image-20230609112215334](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/02c74888-81ef-4542-8a40-8f91aa6dcfc2)

其中的参数含义为：

![image-20230609112241107](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/215327d1-c55f-447d-9a82-ee90f1f9a5d8)



##### **19.3.9.4.6 HT-LTF definition**

HT-LTF用来做MIMO信道估计（QAM映射输出和接收链路之间的MIMO信道；如果使用STBC，就是STBC编码器输出和接收链路之间的MIMO信道）。

关于训练符号个数和空时流个数的关系：

- If the transmitter is providing training for **exactly** the space-time streams (spatial mapper inputs) used for the transmission of

	the PSDU，那么训练符号数$N_{L T F}$等于空时流个数$N_{S T S}$（除了空时流是3个的情况，这时候需要4个训练符号）

- If the transmitter is providing training for **more** space-time streams (spatial mapper inputs) than the number used for the transmission of

	the PSDU, the number of training，那么训练符号数大于空时流个数（这种情况出现在sounding PPDU中）



HT-LTF部分有1个 或 2个部分。

第一个部分包括1、2、4个HT-LTFs（必须，用来解调PPDU的HT-Data部分）。这些HT-LTFs叫做*HT**-**DLTFs*。

第二个部分包括0、1、2、4个HT-LTFs（可选的，用来探测MIMO信道中额外的空间维度，并且不给PPDU的HT-Data部分使用）。这些HT-LTFs叫做*HT-ELTFs*。

如果接收端没有告知他具有接收HT-ELTF的能力，那么他应该在接收到包含HT-ELTF的帧时，发出PHY-RXEND.indication(UnsupportedRate) primitive或者解码该帧。（当一个HT数据包包含一个或多个HT-ELTFs时，对于没有告知其接收HT-ELTF能力的接收端来说，解码PPDU的数据部分是可选的）

用$N_{H T-D L T F}$表示HT-DLTFs的个数。用$N_{H T-E L T F}$表示HT-ELTFs的个数。那么HT-LTFs的总数是这两个的和：$N_{H T-L T F}=N_{H T-D L T F}+N_{H T-E L T F}$。$N_{H T-L T F}$不能超过5。

Table 19-12给出了根据HT-SIG中的MCS和STBC字段确定空时流个数的方法。Table 19-13给出了HT-DLTFs个数和$N_{S T S}$的关系。Table 19-14给出了HT-ELTFs个数和$N_{E S S}$的关系。$N_{S T S}$加上$N_{E S S}$小于等于4。在$N_{S T S}$等于3的时候，$N_{E S S}$不超过1；如果这时候$N_{E S S}$等于1，那么$N_{\text {LTF }}$等于5。

![image-20230609135726511](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/39e7b9af-e1f7-49aa-bb93-51664879bd00)

![image-20230609135739030](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/a9815834-5aba-4dea-bdb7-7225ea7e2ec0)

![image-20230609135748287](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/428f80bf-6a8c-4350-bd45-6562d4660b10)



20MHz中，HT-LTF序列为：


$$
\begin{array}{r}
H T-L T F_{-28,28}=\{1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,0, \\
1,-1,-1,1,1,-1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,1,-1,1,1,1,1,-1,-1\}
\end{array}
$$


注意：这个序列是L-LTF的扩展，把其中的4个子载波填+1（负频率）和-1（正频率）。

40MHz中，包含MCS 32 format 帧中，序列为：


$$
\begin{aligned}
& H T-L T F_{-58,58}=\{1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1, \\
& \quad 1,-1,-1,1,1,-1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,1,-1,1,1,1,1,-1,-1,-1,1,0, \\
& \quad 0,0,-1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,1,1,1, \\
& \quad 1,-1,-1,1,1,-1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,1,-1,1,1,1,1\}
\end{aligned}
$$


注意：这个序列通过扩展L-LTF构建，扩展方法如下：首先复值L-LTF并且按照19.3.9.3.4中移位（对non-HT duplicate format）；然后缺省的自载波位置[-32,-5,-4,-3,-2,2,3,4,5,32]分别用值[1,-1,-1,-1,1,-1,1,1,-1,1]填充。

这个序列占用114个子载波，即使使用MCS 32 format（使用104子载波），也是占用114个子载波。这是为了和其他40MHz格式保持一致，方便波束成形的信道估计和链路自适应。

在HT-MF preamble中，每个HT-LTF包含一个序列加上一个GI，持续时间为4us。在多个空时流的场景中，Table 19-10中的循环移位激活。

HT-DLTFs的生成见Figure 19-9。HT-ELTFs的生成见Figure 19-10。这俩图中使用的符号有：

- $[X]_{m, n}$表示$m$行$n$列的矩阵元素
- $[X]_N$表示矩阵的前$N$列
- $[X]_{M: N}$表示矩阵的$M$到$N$列

其中$M \leq N$，$X$是$Q_k$或者$P_{H T-L T F}$。

![image-20230609141219417](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/f0e3b4e8-089f-42ad-b9be-af46bcda95f4)



空时流和发送链路之间的映射由子载波$k$的天线映射矩阵$Q_k$的列定义。前$N_{S T S}$列定义了用于data发送的空时流，接下来的$N_{E S S}$列（最多有$N_{T X}-N_{S T S}$列）定义了扩展的空间流。这样，为了定义HT-LTFs，$Q_k$的维度是$N_{T X} \times\left(N_{S T S}+N_{E S S}\right)$。$Q_k$的列$1 \ldots N_{S T S}$对应HT-DLTFs，列$N_{S T S}+1 \ldots N_{S T S}+N_{E S S}$对应HT-ELTFs，其中$N_{S T S}+N_{E S S} \leq N_{T X}$是HT-LTFs探测的空间流总数。

$Q_k$的可能性是和一些限制见19.3.11.11.2。$P_{H T-L T F}$见公式19-27。

在HT-DLTF $n$（$1 \leq n \leq N_{H T-D L T F}$）中发送链路$i_{T X}$上发送的时域信号表示为：

![image-20230609142123259](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/6f6bf50c-42ab-4b38-a24e-ae98bd75d483)



对于HT-ELTFs（$N_{H T-D L T F}<n \leq N_{H T-L T F}$），表示为：

![image-20230609142157847](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/f88e8e8c-739f-463a-a3dd-ee6ef3dccecd)



其中的参数：

![image-20230609142217493](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/673d1683-b92e-40b3-95e4-aaee78075ddd)





#### **19.3.9.5 HT-greenfield format preamble**

##### **19.3.9.5.1 General**

对于HT-GF，不需要和17、18章中的STA兼容。因此这种帧格式更短也更有效率，这种帧包括一个STF、LTFs和一个HT-SIG。

##### **19.3.9.5.2 Cyclic shift definition for HT-greenfield format preamble**

在整个HT-GF format preamble中，在不同空间流中发送相似信号时，也需要使用循环移位来避免波束成形。帧里的data部分使用和这些流相同的循环移位。循环移位定义在Table 19-10中。

##### **19.3.9.5.3 HT-GF-STF definition**

HT-GF-STF位于HT-GF的开始位置。在发送链路$i_{T X}$上的HT-GF-STF波形为：

![image-20230609143150950](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/4fb6d27f-4129-461a-bfa3-df4e35341278)



其中的参数：

![image-20230609143206888](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/f97aa2a1-2ab2-4956-b6ca-3e446d0a7f7e)



这个波形的周期是0.8us，HT-GF-STF包含十个这样的周期，得到HT-GF-STF字段的总持续时间为$\mathrm{T}_{H T-G F-S T F}=8 \mu s$。

##### **19.3.9.5.4 HT-greenfield format HT-SIG**

HT-GF中的HT-SIG的内容和格式和HT-MF中的HT-SIG相同，见19.3.9.4.3。HT-SIG的位置见Figure 19-1。In HT-greenfield format frames, the HT-SIG is transmitted with the same cyclic shifts and the same spatial mapping as the preceding portions of the preamble. This use of the same cyclic shifts and spatial mapping is done to accommodate the estimation of channel parameters needed to robustly demodulate and decode the information contained in the HT-SIG.

20MHz中，HT-SIG的时域波形为：

![image-20230609143748662](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/83509d32-d55e-47a6-ae98-c63f3e4c395e)



其中的参数：

![image-20230609143801822](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/f63d8168-3854-4963-8f1d-b7a5d5cf6eb8)



40MHz中，HT-SIG的时域波形为：

![image-20230609143821314](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/955faf51-e959-4230-ab41-b1be1e4d23ed)



其中的参数：

![image-20230609143834855](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/d12a7fc9-2ad0-4ed0-ab00-e0df0fb7c428)





##### **19.3.9.5.5 HT-greenfield format LTF** 

HT-GF的LTF部分和HT-MF中的HT-LTF类似，见19.3.9.4.6，区别在于第一个HT-LTF（HT-LTF1）长度是8us，是其他HT-LTFs的2倍长。HT-GF的第一个HT-LTF表示为：

![image-20230609144534948](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/5428021e-4893-4a76-bd3b-fa4811546650)



其中的参数：

![image-20230609144547726](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/aafbc1b6-ba86-4ff5-94f3-7b5ce110e80e)



HT-LTF1包含一个长训练符号的2个周期，循环前缀的长度也是2倍长度1.6us。位置见Figure 19-1。

### **19.3.10 Transmission of NON_HT format PPDUs with more than one transmit chain**

当HT设备传输NON_HT format PPDU并且MODULATION等于OFDM或ERP-OFDM，使用超过1个传输链路时，在每个链路中应该使用Table 19-9中定义的循环移位。

### **19.3.11 Data field**

#### **19.3.11.1 General**

当使用BCC编码时，Data字段包含16bits的SERVICE字段、PSDU、6bits或12bits的tail比特（取决于编码流是1个还是2个）、pad比特。

当使用LDPC编码时，Data字段包含16bits的SERVICE字段和PSDU，过程见19.3.11.7.5。

当使用BCC编码时，data字段的OFDM符号数计算为：


$$
N_{S Y M}=m_{S T B C}\left\lceil\frac{8 \cdot \text { length }+16+6 \cdot N_{E S}}{m_{S T B C} \cdot N_{D B P S}}\right\rceil
$$


其中的参数：

![image-20230609145519514](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/15fbbc10-c003-4908-873d-93c82d92dd99)



填充的pad 比特个数为$N_{S Y M} \times N_{D B P S}-8 \times$ length $-16-6 \times N_{E S}$。当使用LDPC编码时，data字段的符号数描述见19.3.11.7。

对于LDPC编码，编码的data比特个数$N_{\text {avbits }}$的计算见公式19-39；OFDM符号数$N_{\mathrm{SYM}}$的计算见19-41；用于padding的重复编码比特$N_{\text {rep }}$见公式19-41，见19.3.11.7.5。

#### **19.3.11.2 SERVICE field**

SERVICE字段用于加扰器初始化。

#### **19.3.11.3 Scrambler**

data字段通过17.3.5.5定义的加扰器完成加扰。第17章中的TXVECTOR参数CH_BANDWIDTH_IN_NON_HT和DYN_BANDWIDTH_IN_NON_HT不应该存在；因此，加扰器的初始状态应该设置为伪随机非零种子。

#### **19.3.11.4 Coding**

data字段应该使用17.3.5.6定义的BCC或19.3.11.7定义的LDPC编码。

编码器的选择通过HT-SIG中的FEC coding字段选择（见19.3.9.4.3）。

当使用LDPC编码时，总是使用一个FEC编码器。当使用BCC编码时，除了选择的MCS的PHY速率大于300Mbps（见19.5）时使用2个编码器，其他情况都使用1个编码器。

为了确定使用一个还是两个BCC FEC编码器，速率基于800 ns GI计算。

BCC FEC的操作见19.3.11.6。LPDC的操作间19.3.11.7。



BBC编码的data字段接收是必选项。

#### **19.3.11.5 Encoder parsing operation for two BCC FEC encoders**

如果使用2个BCC编码器，加扰data比特被划分到两个编码器（通过替换比特给不同的编码器）。索引为$i$的比特发送给编码器$j$，用$x_i^{(j)}$表示：$x_i^{(j)}=b_{N_{E S} \cdot i+j} \quad ; \quad 0 \leq j \leq N_{E S}-1$。

在解析操作之后，每个BCC输入序列最后的消息比特的6个加扰0比特被非加扰0比特替换，见17.3.5.3。

替换比特为：$x_i^{(j)} \quad: \quad 0 \leq j \leq N_{E S}-1 \quad ; \quad \frac{\text { length } \cdot 8+16}{N_{E S}} \leq i \leq \frac{\text { length } \cdot 8+16}{N_{E S}}+5$。

#### **19.3.11.6 BCC coding and puncturing**

使用BCC编码时，编码器解析器输出序列$\left\{x_i^0\right\}$和$\left\{x_i^1\right\}$（可用的话），每个都通过速率1/2的卷积编码器，定义见17.3.5.6。编码之后，编码的数据经过17.3.5.7定义的方法打孔，来达到MCS指定的速率。

如果选择速率为5/6的编码，打孔方法见下图。

![image-20230612142856088](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/50f29ad2-4a53-4d29-be5b-cc4932df498c)



#### **19.3.11.7 LDPC codes**

先跳过。



#### **19.3.11.8 Data interleaver**

##### **19.3.11.8.1 Overview**

在完成编码和打孔之后，FEC编码器输出的数据比特流被重新排列到块中，每个块包含$N_{C B P S S}\left(i_{S S}\right)$个比特，$i_{S S}=1,2, \ldots N_{S S}$​是空间流的索引。这个操作叫做stream parsing流解析，见19.3.11.8.2。If BCC encoding was used, each of these blocks is then interleaved by an interleaver that is a modification of the Clause 17 interleaver.

##### **19.3.11.8.2 Stream parser**

在空间流$i_{S S}$中一个星座点的一个坐标轴（实部或虚部）被分配的比特数表示为$s\left(i_{S S}\right)=\max \left\{1, \frac{N_{B P S C S}\left(i_{S S}\right)}{2}\right\}$。所有流的和为：$S=\sum_{i_{S S}=1}^{N_{S S}} s\left(i_{S S}\right)$。

注意：如果所有空间流使用的是equal MCS，那么这个和就是$N_{S S} \cdot s$，这里的$s$是比特数。



如果存在两个编码器，则每个编码器的输出在每个循环周期中交替使用，即在开始时，来自第一个编码器输出的 S 位被馈送到所有空间流，然后来自第二个编码器输出的 S 位 被使用，等等。

![image-20230612152459493](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/4f25f1ce-8099-47c3-9120-e38fe54ff72d)



##### **19.3.11.8.3 Frequency interleaver**

MCS 32的交织使用17.3.5.7中定义的方法。其他MCS的交织方法在本节定义。





#### **19.3.11.9 Constellation mapping** 

##### **19.3.11.9.1 General**

交织器的输出比特和BPSK、QPSK、16QAM、64QAM星座点之前的映射按照17.3.5.8中的规则进行。

复数数据流用$d_{k, l, n}, 0 \leq k \leq N_{S D}-1 ; 1 \leq l \leq N_{S S} ; 0 \leq n \leq N_{S Y M}-1$表示。

##### **19.3.11.9.2 Space-time block coding (STBC)**

本节定了一些可选的robust发送格式，这些发送方式只用于$N_{S T S}$大于$N_{S S}$的场景。

在这种场景中，$N_{S S}$个空间流映射到$N_{S T S}$个空时流，再映射到$N_{T X}$个发送链路上。

这里的发送格式基于STBC。HT-SIG中的STBC字段指示使用STBC的时候，星座点映射和空间映射（见Figure 19-3）之间的符号操作在本节定义。



如果使用STBC，星座点映射器输出的复数流$d_{k, i, n} ; k=0 \ldots N_{S D}-1 ; i=1 \ldots N_{S S} ; n=0 \ldots N_{S Y M}-1$是STBC编码器的输入，输出的复数流用$\tilde{d}_{k, i, n} ; k=0 \ldots N_{S D}-1 ; i=1 \ldots N_{S T S} ; n=0 \ldots N_{S Y M}-1$表示。对于给定的$k$和$i$，STBC处理对OFDM符号的调制符号成对进行，也就是$\tilde{d}_{k, i, 2 m}$取决于$d_{k, i, 2 m}$和$d_{k, i, 2 m+1}$，$\tilde{d}_{k, i, 2 m+1}$也取决于$d_{k, i, 2 m}$和$d_{k, i, 2 m+1}$，像Table 19-18中定义那样。

![image-20230612115420177](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/a0cedb9b-f66c-4efb-b3f8-7a0e7506f78d)

![image-20230612115431756](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/7db2c1ab-94e0-4a7f-bc62-2340a79654b3)



如果不使用STBC，$\tilde{d}_{k, i, n}=d_{k, i, n}$，$N_{S S}=N_{S T S}$。



注意：这里没有描述$N_{S S}=1$，$N_{T X} \geq 3$的STBC，因为这种场景在19.3.11.11.2中的空间扩展涵盖了。

注意：STBC只用于Table 19-18中定义的HT-SIG MCS字段值，不用于MCS 32。





#### **19.3.11.11 OFDM modulation**

##### **19.3.11.11.1 General**

时域信号由复数流$\tilde{d}_{k, l, n}, 0 \leq k \leq N_{S D}-1 ; 1 \leq l \leq N_{S T S} ; 0 \leq n \leq N_{S Y M}-1$和pilots信号组成。在40MHz中，upper子载波相对于lower子载波旋转90°。

##### **19.3.11.11.2 Spatial mapping**

发送端可以选择旋转 和/或 缩放星座点映射器的输出向量（或者，可用的话，空时块编码输出）。旋转 和/或 缩放在以下情况中有用：

- 当发送链路个数比空时流个数多时，$N_{S T S}<N_{T X}$。
- 作为sounding PPDU的一部分（可选项）。
- 作为校正过程的一部分（可选项）。
- 当数据包发送的时候使用其中一个波束成形技术（可选项）。

如果空时流$i_{S T S}$上子载波$k$上的data为$X_k^{\left(i_{S T S}\right)}$，那么发送链路$i_{T X}$上的发送数据为：

![image-20230612153514094](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/5a37ccdd-5f20-46c1-bc1d-639ceca0bfb1)



其中的参数：

![image-20230612153529673](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/6da7d196-b9aa-4ea9-8215-9ddf2357a078)



下面是可能会使用的空间映射矩阵的例子。也存在其他替代矩阵，实现里不限制只用下面的矩阵。例子如下：

1. *Direct mapping*：$Q_k$是单位复数组成的对角阵，选择以下两种形式之一：
	1. $Q_k=\mathbf{I}$，单位阵。
	2. CSD矩阵，对角元素代表时域的循环移位：$\left[Q_k\right]_{i, i}=\exp \left(-j 2 \pi k \Delta_F \tau_{C S}^i\right)$，$\tau_{C S}^i, i=1, \ldots, N_{T X}$表示使用的循环移位。
2. *Indirect mapping*：$Q_k$可能是一个CSD矩阵和一个酉矩阵的乘积，酉矩阵可以是阿达玛矩阵或傅里叶矩阵。
3. *Spatial expansion*：$Q_k$是一个CSD矩阵和一个正交列形成的方阵：
	1. 通过复制$N_{S T S}$流中的一些来形成$N_{T X}$个流，以此得到空间扩展，每个流使用归一化因子$\sqrt{N_{S T S} / N_{T X}}$缩放。空间扩展可以使用以下矩阵中的一个，用$D$表示，左乘一个CSD矩阵，用$M_{C S D}(k)$表示，和/或 可能乘上任何酉矩阵。得到的空间映射矩阵变成$Q_k=M_{C S D}(k) \cdot D$，其中$D$可以取以下值：
		1. $N_{T X}=2, N_{S T S}=1, D=\frac{1}{\sqrt{2}}\left[\begin{array}{ll}1 & 1\end{array}\right]^T$
		2. $N_{T X}=3, N_{S T S}=1, D=\frac{1}{\sqrt{3}}\left[\begin{array}{lll}1 & 1 & 1\end{array}\right]^T$
		3. $N_{T X}=4, N_{S T S}=1, D=\frac{1}{2}\left[\begin{array}{llll}1 & 1 & 1 & 1\end{array}\right]^T$
		4. $N_{T X}=3, N_{S T S}=2, D=\sqrt{\frac{2}{3}}\left[\begin{array}{ll}1 & 0 \\ 0 & 1 \\ 1 & 0\end{array}\right]$
		5. $N_{T X}=4, N_{S T S}=2, D=\frac{1}{\sqrt{2}}\left[\begin{array}{ll}1 & 0 \\ 0 & 1 \\ 1 & 0 \\ 0 & 1\end{array}\right]$
		6. $N_{T X}=4, N_{S T S}=3, D=\frac{\sqrt{3}}{2}\left[\begin{array}{lll}1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \\ 1 & 0 & 0\end{array}\right]$
	2. 子载波间使用不同的空间扩展只能在HT-MF中使用，并且Smoothing比特等于0：
		1. $N_{T X}=2, N_{S T S}=1,\left[Q_k\right]_{N_{S T S}}=\left[\begin{array}{ll}1 & 0\end{array}\right]^T$ or $\left[Q_k\right]_{N_{S T S}}=\left[\begin{array}{ll}0 & 1\end{array}\right]^T$
		2. $N_{T X}=3, N_{S T S}=2,\left[Q_k\right]_{N_{S T S}}=\left[\begin{array}{ll}1 & 0 \\ 0 & 0 \\ 0 & 1\end{array}\right],\left[\begin{array}{ll}1 & 0 \\ 0 & 1 \\ 0 & 0\end{array}\right]$ or $\left[\begin{array}{ll}0 & 0 \\ 1 & 0 \\ 0 & 1\end{array}\right]$
		3. $N_{T X}=4, N_{S T S}=2,\left[Q_k\right]_{N_{S T S}}=\left[\begin{array}{ll}1 & 0 \\ 0 & 0 \\ 0 & 0 \\ 0 & 1\end{array}\right],\left[\begin{array}{ll}1 & 0 \\ 0 & 0 \\ 0 & 1 \\ 0 & 0\end{array}\right],\left[\begin{array}{ll}0 & 0 \\ 1 & 0 \\ 0 & 0 \\ 0 & 1\end{array}\right]$ or $\left[\begin{array}{ll}0 & 0 \\ 1 & 0 \\ 0 & 1 \\ 0 & 0\end{array}\right]$
		4. $N_{T X}=4, N_{S T S}=3,\left[Q_k\right]_{N_{S T S}}=\left[\begin{array}{lll}1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 0 \\ 0 & 0 & 1\end{array}\right]$ or $\left[\begin{array}{lll}1 & 0 & 0 \\ 0 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1\end{array}\right]$
4. *Beamforming steering matrix*：$Q_k$是任何矩阵，只要这个矩阵是基于信道知识得到的能够提高接收性能。使用显式反馈波束成形的时候，控制矩阵$Q_k$通过CSI反馈的$H_{e f f}$或者非压缩和压缩反馈矩阵$V_k$确定。



当空时流个数少于发送链路数时，这个矩阵的前$N_{S T S}$列被使用。

HT-GF和HT-MF中的HT-STF和HT-STF字段后的所有部分，对所有的子载波使用相同的矩阵$Q_k$。

使用波束成形控制矩阵时，Smoothing比特要设置为0。

Table 19-10中的CSD作为空间映射器的输入。

对于单位阵的direct mapping，Smoothing比特应该设置为1。

如果没有使用空间映射矩阵，那么$Q_k$为单位阵，$N_{S T S}=N_{T X}$。

使用空间扩展的sounding PPDU应该使用正交列矩阵$Q_k$。当行数和列数相等时，这个正交列矩阵就是酉矩阵。

##### **19.3.11.11.3 Transmission in 20 MHz HT format**

![image-20230612163013274](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/ac184000-7aa7-482c-913c-bb903127bc05)

其中的参数：

![image-20230612163028413](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/7a19a465-c29f-4720-8005-44e34f3e232b)



##### **19.3.11.11.4 Transmission in 40 MHz HT format**

![image-20230612163045287](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/36940a19-2072-4135-8b03-216eb9c2e495)

其中的参数：

![image-20230612163106716](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/69d51827-0145-4faa-8afc-8119b5d9ab29)



![image-20230612163106716](./2023-06-06-WIFI协议第19章.assets/image-20230612163106716.png)



注意：40MHz的upper部分使用了90°旋转（HT-STF、HT-LTF、HT-SIG）。

##### **19.3.11.11.5 Transmission in MCS 32 format**

MCS 32格式提供了40MHz的最低传输速率。他只用于1个空间流和速率1/2的BPSK调制。

![image-20230612163331000](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/9a0c8a30-b910-4057-b9a8-6ddf14fbc69e)

其中的参数：

![image-20230612163341967](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/0945775f-f163-481e-a5d8-d1f5ff4a63ef)


##### **19.3.11.11.6 Transmission with a short GI**





#### **19.3.11.12 Non-HT duplicate transmission**



### **19.3.12 Beamforming** 

#### **19.3.12.1 General**

波束成形是利用MIMO信道知识生成一个控制矩阵，来提高接收性能的技术。

下图是一个示例。

![image-20230606162541589](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/82b897f2-3547-4d06-9d11-3838514d398c)



假设子载波$k$发送的信号向量是$\mathbf{x}_k=\left[x_1, x_2, \ldots x_{N_{T X}}\right]^T$，接收信号向量是$\mathbf{y}_k=\left[y_1, y_2, \ldots y_{N_{R X}}\right]^T$，信号模型是$\mathbf{y}_k=H_k \mathbf{x}_k+\mathbf{n}$。

使用波束成形时，波束成形器用$Q_k \mathbf{x}_k$替换发送信号$\mathbf{x}_k$，这时候$N_{S T S} \leq N_{T X}$，$Q_k$的维度是$N_{T X}$行$N_{S T S}$列，这样接收信号表示为$\mathbf{y}_k=H_k Q_k \mathbf{x}_k+\mathbf{n}$。

从新的信道测量中计算（或更新）的波束成形控制矩阵取代了下一个波束成形数据传输的现有控制矩阵$Q_k$。有几种波束形成方法，不同之处在于波束形成器获取信道矩阵知识的方式以及波束形成器是生成还是波束形成者为波束形成器提供反馈信息以生成 。



通过检测信道状态信息CSI（Channel State Information）来获取并计算出调整参数的。按照CSI获取方式的不同，波束成形可以分为显式波束成形（Explicit beamforming）和隐式波束成形（Implicit beamforming）。



显式波束成形是一种需要STA反馈信道信息的波束成形方式。显式波束成形信道信息的探测和反馈流程如下：

![image-20230607113422167](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/29ebb165-8726-4aa5-8490-579070722417)



1. AP向STA发送探测数据（Training Symbol）。在802.11n标准中，AP发送探测数据包括空数据包（NDP）和交错前导码两种方式；802.11ac标准开始则直接使用NDP的方式。

	- NDP是一种没有数据的空帧，其没有负荷。AP向STA发送NDP探测通告和空数据包，STA收到探测通告和空数据包后进行信道信息反馈。
	- 交错前导码是利用发送的带有负荷的帧实现探测，这个帧会承载一个MAC帧和探测信道。

2. STA向AP反馈信道信息。

	在802.11n标准中，STA的信道信息反馈有三种方式：

	- CSI方式：STA将原始的信道信息直接发送给AP，由AP计算最终的波束成形权重值。
	- 非压缩波束成形权重值：STA收到探测后，由STA计算出波束成形权重值后反馈给AP。这种方式会增加系统开销，因此有了压缩波束成形权重值。
	- 压缩波束成形权重值：同样是由STA计算出波束成形权重值后反馈给AP，并且通过一些方法降低了系统开销。

	**802.11ac标准开始，STA采用压缩波束成形权重值的方式反馈信道信息。**

3. AP根据STA反馈或自己计算的权重信息进行波束成形，多径信号在STA处汇聚，形成增益。



隐式波束成形是由Beamformer计算发送方向信道信息的波束成形方式，其利用了时分双工（TDD，Time Division Duplexing）系统的互易性（即认为同频段的上下行的信道状态信息是相等的），将Beamformee反馈的上行接收方向信道信息直接应用于下行发送方向，进行波束成形。由于隐式波束成形具体实现的复杂性，**从[802.11ac](https://info.support.huawei.com/info-finder/encyclopedia/zh/802.11ac.html)协议开始已经明确不再支持隐式波束成形且业界也基本无厂商实现该方式波束成形**，这里我们也不再做更详细的描述。

#### **19.3.12.2 Implicit feedback beamforming**

隐式反馈波束成形是一种技术，它依赖于时分双工信道中的互易性，根据从计划传输到的设备接收到的MIMO参考来估计设备正在传输的信道。这种技术允许发送设备计算一系列发送控制矩阵$Q_k$，每个子载波一个，用来优化链路性能。

参考Figure 19-14，从STA A到STA B使用隐式波束成形技术的时候，STA B向STA A发送一个sounding PPDU，STA A接收到sounding PPDU后允许STA A估计从STA B到STA A的MIMO信道，对于所有的子载波。在一个TDD信道中，前向和反向信道是互易的，子载波$k$上，STA A到STA B的信道是STA B到STA A的信道矩阵的转置，并且会有一个复值系数，比如：$H_{\mathrm{AB}, k}=\rho\left[H_{\mathrm{BA}, k}\right]^T$。STA A使用这种关系计算发送控制矩阵。

注意：为了让sounding的接收者在使用受控或未受控探测时计算控制矩阵，控制矩阵需要具有以下属性$\left(H_k Q_k\right)\left(H_k Q_k\right)^H=H_k H_k^H$，其中$X^H$表示矩阵$X$的共轭转置。

上面说的互惠性，在实际中收到幅度和相位的影响可能不满足，这时候就需要10.34.2.4中的校正过程，来保存这种互惠性。如果使用了矫正过程，可以认为这种互惠性是够用的。

Figure 19-15解释了观察的基带信道，包括回互惠性校正。为了简化，这里的空间映射矩阵$Q_{\mathrm{A}, k}$和$Q_{\mathrm{B}, k}$假设为单位阵。

![image-20230606165739358](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/0a5c215d-b423-4f70-bf96-95977f45c2ef)



用于sounding PPDU的空间映射矩阵见19.3.13.3。

发射链和接收链的幅度和相位响应可以表示为具有复值对角线项的对角线矩阵，STA A处的矩阵用$A_{T X, k}$和$A_{R X, k}$表示。baseband-to-baseband channel $\tilde{H}_{\mathrm{AB}, k}$，和over-the-air channel $H_{\mathrm{AB}, k}$的关系为：$\tilde{H}_{\mathrm{AB}, k}=B_{\mathrm{RX}, k} H_{\mathrm{AB}, k} A_{\mathrm{TX}, k}$。类似的有$\tilde{H}_{\mathrm{BA}, k}=A_{\mathrm{RX}, k} H_{\mathrm{BA}, k} B_{\mathrm{TX}, k}$。

举例来说，考虑A和B都是用了校正过程。目标是计算矫正矩阵$K_{\mathrm{A}, k}$和$K_{\mathrm{B}, k}$，根据互易性满足：$\tilde{H}_{\mathrm{AB}, k} K_{\mathrm{A}, k}=\rho\left[\tilde{H}_{\mathrm{BA}, k} K_{\mathrm{B}, k}\right]^{\mathrm{T}}$。矫正矩阵是复对角矩阵。互易性条件可以表示为：$K_{\mathrm{A}, k}=\alpha_{\mathrm{A}, k}\left[A_{\mathrm{TX}, k}\right]^{-1} A_{\mathrm{RX}, k}$和$K_{\mathrm{B}, k}=\alpha_{\mathrm{B}, k}\left[B_{\mathrm{TX}, k}\right]^{-1} B_{\mathrm{RX}, k}$。这样可以得到，校正后A和B之间的baseband-to-baseband channel：$\hat{H}_{\mathrm{AB}, k}=\tilde{H}_{\mathrm{AB}, k} K_{\mathrm{A}, k}=\alpha_{\mathrm{A}, k} B_{\mathrm{RX}, k} H_{\mathrm{AB}, k} A_{\mathrm{RX}, k}$，$\hat{H}_{\mathrm{BA}, k}=\alpha_{\mathrm{B}, k} A_{\mathrm{RX}, k} H_{\mathrm{BA}, k} B_{\mathrm{RX}, k}=\frac{\alpha_{\mathrm{B}, k}}{\alpha_{\mathrm{A}, k}}\left[\hat{H}_{\mathrm{AB}, k}\right]^{\mathrm{T}}$。



总结下来，对A，估计$K_{\mathrm{A}, k}$的过程如下：

1. A发送一个sounding PPDU给B，使得B可以估计信道矩阵$\tilde{H}_{\mathrm{AB}, k}$。
2. B发送一个sounding PPDU给A，使得A可以估计信道矩阵$\tilde{H}_{\mathrm{BA}, k}$。
3. B发送量化的估计$\tilde{H}_{\mathrm{AB}, k}$给A。
4. A使用本地估计的$\tilde{H}_{\mathrm{BA}, k}$和从B接受的量化估计$\tilde{H}_{\mathrm{AB}, k}$，计算矫正矩阵$K_{\mathrm{A}, k}$。

![image-20230606172519187](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/bac86499-103d-4c5b-a0d9-27afdeb21bf0)



#### **19.3.12.3 Explicit feedback beamforming**

##### **19.3.12.3.1 General**

在显式波束成形中，A为了发送一个波束成形后的数据包给B，B测量信道矩阵并且把effective channel $H_{e f f, k}$ 或者 波束成形反馈矩阵$V_k$ 发送给A，A来确定一个控制矩阵，$Q_{\text {steer }, k}=Q_k V_k$，$V_k$根据$H_k Q_k$得到，其中$Q_k$是正交的空间映射矩阵，用来发送sounding PPDU探测$V_k$。effective channel $H_{e f f, k}=H_k Q_k$。发现新的控制矩阵$Q_{\text {steer }, k}$时，$Q_{\text {steer }, k}$会替换$Q_k$用于下一次数据发送。

##### **19.3.12.3.2 CSI matrices feedback**

在CSI矩阵反馈中，波束成形器接收量化的MIMO信道矩阵$H_{e f f}$，波束成形器然后使用这个矩阵计算一些发送控制矩阵$Q_k$。CSI矩阵$H_{e f f}$，应该根据发送端空间映射器输入到FFT输出来确定。The beamformee shall remove the CSD in Table 19-10 from the measured channel matrix.

##### **19.3.12.3.3 CSI matrices feedback decoding procedure**

接受到的量化矩阵$H_{e f f}^q(k)$的解码过程如下：

1. 用$H_{e f f(m, l)}^{q(R)}(k)$和$H_{e f f(m, l)}^{q(I)}(k)$表示矩阵每个元素的实部虚部，are decoded as a pair of 2s complement numbers to create the complex element，$1 \leq m \leq N_r$，$1 \leq l \leq N_c$。
2. 子载波$k$的矩阵中的每个元素使用carrier matrix amplitude field (3 bits) $M_H(k)$（正数，dB）进行缩放。如下：
	1. 把dB值转换为线性值$r(k)=10^{M_H(k) / 20}$。
	2. 计算解码值$\operatorname{Re}\left\{\tilde{H}_{e f f(m, l)}(k)\right\}=\frac{H_{e f f(m, l)}^{q(R)}(k)}{r(k)}$、$\operatorname{Im}\left\{\tilde{H}_{e f f(m, l)}(k)\right\}=\frac{H_{e f f(m, l)}^{q(I)}(k)}{r(k)}$。



##### **19.3.12.3.4 Example of CSI matrices feedback encoding**

编码过程的示例：

1. 确定每个子载波中每个元素实部虚部的最大值：![image-20230607112401647](./2023-06-06-WIFI协议第19章.assets/image-20230607112401647.png)
2. 比例系数被量化到3比特：$M_H(k)=\min \left\{7,\left|20 \log _{10}\left(\frac{\max \left\{m_H(z)\right\}_{z=-N_{S R}}^{z=N_{S R}}}{m_H(k)}\right)\right|\right\}$，$M_H^{\operatorname{lin}}(k)=\frac{\max \left\{m_H(z)\right\}_{z=-N_{S R}}^{z=N_{S R}}}{10^{M_H(k) / 20}}$。
3. 矩阵$H_{e f f(m, l)}(k)$的每个元素的实部虚部被量化为$N_b$个比特$H_{e f f(m, l)}^{q(R)}(k)=\left\lfloor\frac{\operatorname{Re}\left\{H_{e f f(m, l)}(k)\right\}}{M_H^{\operatorname{lin}}(k)}\left(2^{N_b-1}-1\right)+0.5\right\rfloor$、$H_{e f f(m, l)}^{q(I)}(k)=\left\lfloor\frac{\operatorname{Im}\left\{H_{e f f(m, l)}(k)\right\}}{M_H^{\mathrm{in}}(k)}\left(2^{N_b-1}-1\right)+0.5\right\rfloor$。

每个矩阵使用$3+2 \times N_b \times N_r \times N_c$个比特编码，$N_b$可以是4、5、6、8。

##### **19.3.12.3.5 Noncompressed beamforming feedback matrix**

在非压缩的波束成形反馈矩阵中，在计算一系列反馈矩阵给beamformer之前，beamformee要从测量的信道中移除Table 19-10中的空时流CSD。波束成形反馈矩阵用$V(k)$表示（由beamformee找到），被发送给beamformer（以每个子载波的实部虚部的顺序，见9.4.1.28）。beamformer通过这些矩阵确定控制矩阵$Q_k$。

beamformee应该对$V(k)$编码，beamformer使用下面的过程来重建这个矩阵（这是可选的）。

接收到的矩阵$V^q(k)$按照下面过程解码：

1. 矩阵的每个元素的实部虚部$V_{m, l}^{q, R}$和$V_{m, l}^{q, I}$，解码作为2进制补码，$1 \leq m \leq N_r$，$1 \leq l \leq N_c$。
2. 波束成形反馈矩阵的维度是$N_r \times N_c$。每个矩阵用$2 \times N_b \times N_r \times N_c$个比特编码，$N_b$可能是2、4、6、8。
3. 波束成形反馈矩阵的列$1 \ldots N_c$对应空间流$1 \ldots N_c$。按照MCS，空间流映射到调制，见19.5。在确定控制矩阵中，发送端不应该对波束成形反馈矩阵的列重新排序。

##### **19.3.12.3.6 Compressed beamforming feedback matrix**

在压缩的波束成形反馈矩阵中，在计算一系列反馈矩阵给beamformer之前，beamformee要从测量的信道中移除Table 19-10中的空时流CSD。波束成形反馈矩阵用$V(k)$表示（由beamformee找到），这个矩阵以角度的形式被压缩，然后发送给beamformer。beamformer可能通过这些角度来解压缩这个矩阵并且确定控制矩阵$Q_k$。

每个子载波的矩阵$V$被压缩的过程如下：beamformee找到的反馈正交列矩阵$V$的维度是$N_r \times N_c$，并且表示为下面形式：


$$
V=\left[\prod_{i=1}^{\min \left(N_c, N_r-1\right)}\left[D_i\left(1_{i-1} e^{j \phi_{i, i}} \ldots e^{j \phi_{N_r-1, i}} 1\right) \prod_{l=i+1}^{N_r} G_{l i}^T\left(\psi_{l i}\right)\right]\right] \tilde{I}_{N_r \times N_c}
$$


这里的矩阵$D_i\left(1_{i-1} e^{j \phi_{i, i}} \ldots e^{j \phi_{N_r-1, i}} 1\right)$是$N_r \times N_r$的对角阵，$1_{i-1}$表示长度为$i-1$的1序列，


$$
D\left(1_{i-1} e^{j \phi_{i, i}} \ldots e^{j \phi_{N_r-1, i}} 1\right)=\left[\begin{array}{ccccc}
I_{i-1} & 0 & \ldots & \ldots & 0 \\
0 & e^{j \phi_{i, i}} & 0 & \ldots & 0 \\
\ldots & 0 & \ddots & 0 & 0 \\
\ldots & \ldots & 0 & e^{j \phi_{N_r-1, i}} & 0 \\
0 & 0 & 0 & 0 & 1
\end{array}\right]
$$


矩阵$G_{l i}(\psi)$是$N_r \times N_r$的Givens rotation matrix，


$$
G_{l i}(\psi)=\left[\begin{array}{ccccc}
I_{i-1} & 0 & 0 & 0 & 0 \\
0 & \cos (\psi) & 0 & \sin (\psi) & 0 \\
0 & 0 & I_{l-i-1} & 0 & 0 \\
0 & -\sin (\psi) & 0 & \cos (\psi) & 0 \\
0 & 0 & 0 & 0 & I_{N_r-l}
\end{array}\right]
$$


这里的$\cos (\psi)$和$\sin (\psi)$位于$l$行$i$列。$\tilde{I}_{N_r} \times N_c$是额外行列补零（$N_r \neq N_c$时）的单位阵。



举例来说，$4 \times 2$的$V$矩阵为：


$$
\begin{aligned}
& V=\left[\begin{array}{cccc}
e^{j \phi_{11}} & 0 & 0 & 0 \\
0 & e^{j \phi_{21}} & 0 & 0 \\
0 & 0 & e^{j \phi_{31}} & 0 \\
0 & 0 & 0 & 1
\end{array}\right] \times\left[\begin{array}{cccc}
\cos \psi_{21} & \sin \psi_{21} & 0 & 0 \\
-\sin \psi_{21} & \cos \psi_{21} & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{array}\right]^T \times\left[\begin{array}{cccc}
\cos \psi_{31} & 0 & \sin \psi_{31} & 0 \\
0 & 1 & 0 & 0 \\
-\sin \psi_{31} & 0 & \cos \psi_{31} & 0 \\
0 & 0 & 0 & 1
\end{array}\right]^T \times\left[\begin{array}{cccc}
\cos \psi_{41} & 0 & 0 & \sin \psi_{41} \\
0 & 1 & 0 & 0 \\
0 & 0 & 1 & 0 \\
-\sin \psi_{41} & 0 & 0 & \cos \psi_{41}
\end{array}\right]^T \\
& \times\left[\begin{array}{cccc}
1 & 0 & 0 & 0 \\
0 & e^{j \phi_{22}} & 0 & 0 \\
0 & 0 & e^{j \phi_{32}} & 0 \\
0 & 0 & 0 & 1
\end{array}\right] \times\left[\begin{array}{cccc}
1 & 0 & 0 & 0 \\
0 & \cos \psi_{32} & \sin \psi_{32} & 0 \\
0 & -\sin \psi_{32} & \cos \psi_{32} & 0 \\
0 & 0 & 0 & 1
\end{array}\right]^T \times\left[\begin{array}{cccc}
1 & 0 & 0 & 0 \\
0 & \cos \psi_{42} & 0 & \sin \psi_{42} \\
0 & 0 & 1 & 0 \\
0 & -\sin \psi_{42} & 0 & \cos \psi_{42}
\end{array}\right]^T \times\left[\begin{array}{ll}
1 & 0 \\
0 & 1 \\
0 & 0 \\
0 & 0
\end{array}\right] \\
&
\end{aligned}
$$


查找压缩$V$矩阵的过程描述如下：

维度为$N_r \times N_c$的波束成形反馈正交列矩阵$V$是逐列相位不变的，因为控制矩阵的每列在相位上需要一个参考。当行数和列数相等的时候，这个正交列矩阵是酉矩阵。换句话说，$V$等于$\tilde{V} \tilde{D}$，其中$\tilde{D}$是逐列移相矩阵$\tilde{D}=\operatorname{diag}\left(e^{j \theta_1}, e^{j \theta_2}, \ldots, e^{j \theta_{N_c}}\right)$。当beamformee估计信道的时候，可以找到$\tilde{V}$，但是需要发送给beamformer的是$\tilde{V} \tilde{D}$，$V=\tilde{V} \tilde{D}$。$\tilde{D}$中的角度$\theta_i$保证$\tilde{V} \tilde{D}$的一行是非负实数。

对角矩阵$D_1\left(e^{j \phi_{11}} \ldots e^{j \phi_{N_r-1,1}} 1\right)^*$中的角度$\phi_{1,1} \ldots \phi_{N_r-1,1}$应该满足这样的约束：$D_1^* V$的第一列的所有元素是非负实数。通过Givens矩阵，$\left(G_{N_r 1} \ldots G_{31} G_{21} D_1^*\right) \times V$的第一列变成$\left[\begin{array}{llll}1 & 0 & \ldots & 0\end{array}\right]^T$：


$$
\left[\begin{array}{cccc}
\cos \psi_{N_r 1} & 0 & 0 & \sin \psi_{N_r 1} \\
0 & 1 & 0 & 0 \\
0 & 0 & 1 & 0 \\
-\sin \psi_{N_r} & 0 & 0 & \cos \psi_{N_r}
\end{array}\right] \cdots\left[\begin{array}{cccc}
\cos \psi_{31} & 0 & \sin \psi_{31} & 0 \\
0 & 1 & 0 & 0 \\
-\sin \psi_{31} & 0 & \cos \psi_{31} & 0 \\
0 & 0 & 0 & 1
\end{array}\right]\left[\begin{array}{cccc}
\cos \psi_{21} & \sin \psi_{21} & 0 & 0 \\
-\sin \psi_{21} & \cos \psi_{21} & 0 & 0 \\
0 & 0 & 1 & 0 \\
0 & 0 & 0 & 1
\end{array}\right]\left[\begin{array}{cccc}
e^{j \phi_{11}} & 0 & 0 & 0 \\
0 & 0 & 0 & 0 \\
0 & 0 & e^{j \phi_{N_r-1,1}} & 0 \\
0 & 0 & 0 & 1
\end{array}\right]^* \times V=\left[\begin{array}{llll}
1 & 0 & 0 & 0 \\
0 & & \\
0 & V_2 \\
0 & &
\end{array}\right]
$$


对一个新的维度$\left(N_r-1\right) \times\left(N_c-1\right)$的子矩阵$V_2$，使用相同的过程。然后，对角矩阵$D_2\left(1 e^{j \phi_{22}} \ldots e^{j \phi_{N_r-1,2}} 1\right)^*$的角度$\phi_{2,2} \ldots \phi_{N_r-1,2}$满足这个约束：$D_2^* \times \operatorname{diag}\left(1, V_2\right)$的第二列的所有元素是非负实数。这样$\left(G_{N_r 2} \ldots G_{32} D_2^*\right)\left(G_{N_r 1} \ldots G_{31} G_{21} D_1^*\right) \times V$的前两列通过Givens矩阵$G_{l 2}$变成$\tilde{I}_{N_r \times 2}$：


$$
\left[\begin{array}{cccc}
1 & 0 & 0 & 0 \\
0 & \cos \psi_{N_r 2} & 0 & \sin \psi_{N_r 2} \\
0 & 0 & 1 & 0 \\
0 & -\sin \psi_{N_r} & 0 & \cos \psi_{N_r}
\end{array}\right] \ldots\left[\begin{array}{cccc}
1 & 0 & 0 & 0 \\
0 & \cos \psi_{32} & \sin \psi_{32} & 0 \\
0 & -\sin \psi_{32} & \cos \psi_{32} & 0 \\
0 & 0 & 0 & 1
\end{array}\right]\left[\begin{array}{cccc}
1 & 0 & 0 & 0 \\
0 & e^{j \phi_{22}} & 0 & 0 \\
0 & 0 & e^{j \phi_{N_r-1,2}} & 0 \\
0 & 0 & 0 & 1
\end{array}\right] \times G_{N, 1} \ldots G_{31} G_{21} D_1^* \times V=\left[\begin{array}{cccc}
1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 \\
0 & 0 & V_3 \\
0 & 0 &
\end{array}\right]
$$


执行相同的过程直到右侧矩阵的前$N_c$列变成$\tilde{I}_{N_r \times N_c}$。当$N_c<N_r$时，这个过程不需要继续，因为$V_{N_c+1}$通过$\tilde{I}_{N_r \times N_c}$变成0了。然后，通过左乘$D_i$和$G_{l i}$矩阵乘积的共轭转置，$V$可以表示为：


$$
V=D_1 G_{21}^T G_{31}^T \ldots G_{N_r 1}^T \times D_2 G_{32}^T G_{42}^T \ldots G_{N_r 2}^T \times \ldots \times D_p G_{p+1, p}^T G_{p+2, p}^T \ldots G_{N_r p}^T \times \tilde{I}_{N_r \times N_C}
$$


其中，$p=\min \left(N_c, N_r-1\right)$，也可以写成上面的紧凑形式。

从分解过程中得到的角度，$\psi_{i, j}$和$\phi_{k, l}$按照9.6.11.7中的描述做量化。

波束成形反馈矩阵的列$1 \ldots N_c$对应空间流$1 \ldots N_c$。按照MCS，空间流映射到调制，见19.5。在确定控制矩阵中，发送端不应该对波束成形反馈矩阵的列重新排序。

### **19.3.13 HT Preamble format for sounding PPDUs**

#### **19.3.13.1 General**

MIMO信道测量发生在每个PPDU，根据发送的preamble的HT-LTFs部分。发送的HT-LTFs的个数应该通过空时流个数确定（除非使用HT-ELTF可选地探测额外的维度，并且这些是使用与用于HT PPDU的数据字段的相同空间变换传输的）。使用相同的空间变换使得能够在接收器处计算空间均衡。

当空时流个数$N_{S T S}$小于发送天线数，或者小于$\min \left(N_{T X}, N_{R X}\right)$，只发送$N_{S T S}$个HT-LTFs不能够恢复完整的MIMO信道特性，即使MIMO信道测量结果足够接收HT PPDU的Data字段。

通常希望尽可能获取信道的所有特性。这就需要HT-LTFs的个数足够来探测信道的所有维度信息，有时是$N_{T X}$个有时是$\min \left(N_{T X}, N_{R X}\right)$个。这些MIMO信道测量称为*MIMO channel sounding*。

一个sounding PPDU被用来探测可用的信道维度。通过设置HT-SIG的Not Sounding字段为0来只是一个sounding PPDU。一个sounding PPDU可以与任意满足$N_{H T-L T F} \geq N_{S T S}$的HT-LTFs个数。如果HT-SIG的Not Sounding字段为0并且$N_{H T-L T F} \geq N_{S T S}$，使用HT-ELTFs，除了$N_{S S}=3$和$N_{H T-L T F}=4$或者NDP。

#### **19.3.13.2 Sounding with a NDP**

一个STA可能使用NDP探测信道（HT-SIG的HT Length字段等于0），HT-SIG的Not Sounding字段为0。LTFs的个数由MCS只是，并且应该只是2个或更多空间流。NDP的最后一个HT-LTF没有Data字段，见下图。

![image-20230612165511791](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/1f84ff96-cbc4-4993-b5f6-c6d54d7dbb4c)

处理NDP是可选项。

#### **19.3.13.3 Sounding PPDU for calibration**

一个双向校正交换场景中，2个STA及交换sounding PPDUs，这个交换使得接收STA计算MIMO信道矩阵的估计$H_k$，对每个子载波$k$。在交换校正消息的过程中，空间流个数小于发送天线数。这种场景中使用HT-ELTFs。用于校正的sounding PPDU中，天线映射矩阵为$Q_k=C_{C S D}(k) P_{C A L}$。

其中的参数：

![image-20230612170008246](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/cbd63607-8e9b-41be-a6d2-ca9e0a8c4e97)

#### **19.3.13.4 Sounding PPDU for channel quality assessment**

暂时跳过。

## **19.5 Parameters for HT-MCSs**

Table 19-26定义了速率相关的参数符号。

![image-20230607114308936](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/914b088b-f8af-45e9-8495-f7b061d096c5)



下面的MCS参数表中，400 ns GI的数据速率保留移位小数。



必选20MHz、$N_{S S}=1$、$N_{E S}=1$的MCS见Table 19-27。

![image-20230607114517660](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/8a8cd038-b365-400f-90dc-a6612602d87e)


可选20MHz、$N_{S S}=2$、$N_{E S}=1$、EQM的MCS见Table 19-28。

![image-20230607114621282](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/743481b2-6e19-4709-b328-a34076c5db6f)



可选20MHz、$N_{S S}=3$、$N_{E S}=1$、EQM的MCS见Table 19-29。

![image-20230607114653934](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/9cbfc4f9-e395-4069-be04-ed35c37f466c)



可选20MHz、$N_{S S}=4$、$N_{E S}=1$、EQM的MCS见Table 19-30。

![image-20230607114729281](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/108a5743-ce8b-4bd3-859c-3078dde9e937)



可选40MHz、$N_{S S}=1$、$N_{E S}=1$的MCS见Table 19-31。

![image-20230607114802030](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/15e82ac7-b964-4666-b2d7-7d9dfd40b8b5)



可选40MHz、$N_{S S}=2$、$N_{E S}=1$、EQM的MCS见Table 19-32。

![image-20230607114833117](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/e118d2cb-207d-4d86-89b5-5f83acba8270)



可选40MHz、$N_{S S}=3$、EQM的MCS见Table 19-33。

![image-20230607114937150](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/c3fe4aa2-4185-4212-b704-d7d78c4e5005)



可选40MHz、$N_{S S}=4$、EQM的MCS见Table 19-34。

![image-20230607115000718](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/d4559ecf-3ea5-4177-8791-d9782fa9d255)



可选40MHz、$N_{S S}=1$、$N_{E S}=1$、MCS 32的MCS见Table 19-35。

![image-20230607115052087](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/921cb7c2-2613-4a1e-9ddf-dcd5cac19cab)



可选20MHz、$N_{S S}=2$、$N_{E S}=1$、UEQM的MCS见Table 19-36。

![image-20230607115132299](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/955a4827-650c-4404-aea0-242e6ecc599e)



可选20MHz、$N_{S S}=3$、$N_{E S}=1$、UEQM的MCS见Table 19-37。

![image-20230607115203781](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/b21c29e3-ab65-48d8-94c3-e32d95effc83)



可选20MHz、$N_{S S}=4$、$N_{E S}=1$、UEQM的MCS见Table 19-38。

![image-20230607115305636](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/baead7ce-449f-459e-b5f0-e3ad9330526a)


![image-20230607115318999](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/b8db472c-a172-43d4-ac5b-b79f84255f4c)





可选40MHz、$N_{S S}=2$、$N_{E S}=1$、UEQM的MCS见Table 19-39。

![image-20230607115357837](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/7e111fdf-bbeb-4950-8e13-8be8061860f2)



可选40MHz、$N_{S S}=3$、UEQM的MCS见Table 19-40。

![image-20230607115439287](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/bcea5d73-f66e-4bb0-8bac-53878823e118)



可选40MHz、$N_{S S}=4$、UEQM的MCS见Table 19-41。

![image-20230607115506557](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/1dd390ed-40aa-42f6-b1eb-c25acf0d2df4)

![image-20230607115521208](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/10f68710-b41f-4ad6-9ac3-ff59b9c0fdc1)

![image-20230607115534699](https://github.com/geoffreyhou/geoffreyhou.github.io/assets/115327603/d4f429e1-f5e1-430b-bb87-4e86a8ae70ce)



